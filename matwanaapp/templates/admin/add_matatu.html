{% extends 'admin/base.html' %}
{% block title %}Add New Matatu{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 text-gray-800">
            <i class="fas fa-bus fa-fw mr-2"></i>Add New Matatu
        </h1>
        <a href="{% url 'manage_matatus' %}" class="btn btn-secondary">
            <i class="fas fa-arrow-left fa-fw mr-1"></i> Back
        </a>
    </div>

    <!-- Flash Messages -->
    {% if messages %}
    {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
    {% endfor %}
    {% endif %}

    <!-- Add Matatu Form -->
    <div class="row">
        <div class="col-lg-8">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Matatu Information</h6>
                </div>
                <div class="card-body">
                    <form method="POST" action="{% add_matatu'%}">
                        <!-- Registration Details -->
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="registration_number">Registration Number *</label>
                                    <input type="text" class="form-control" id="registration_number" 
                                           name="registration_number" required 
                                           placeholder="e.g., KAA 123A">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="name">Matatu Name (Optional)</label>
                                    <input type="text" class="form-control" id="name" name="name" 
                                           placeholder="e.g., Speed Shuttle">
                                </div>
                            </div>
                        </div>

                        <!-- SACCO Selection -->
                        <div class="form-group">
                            <label for="sacco_id">SACCO *</label>
                            <select class="form-control" id="sacco_id" name="sacco_id" required>
                                <option value="">Select SACCO</option>
                                {% for sacco in saccos %}
                                    <option value="{{ sacco.id }}">{{ sacco.name }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- Vehicle Details -->
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="make">Make/Model *</label>
                                    <input type="text" class="form-control" id="make" name="make" 
                                           required placeholder="e.g., Toyota Hiace">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="year">Year of Manufacture</label>
                                    <input type="number" class="form-control" id="year" name="year" 
                                           min="1990" max="2024" 
                                           placeholder="e.g., 2020">
                                </div>
                            </div>
                        </div>

                        <!-- Capacity and Route -->
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="capacity">Passenger Capacity *</label>
                                    <input type="number" class="form-control" id="capacity" 
                                           name="capacity" required min="14" max="52"
                                           placeholder="e.g., 33">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="route_id">Assigned Route (Optional)</label>
                                    <select class="form-control" id="route_id" name="route_id">
                                        <option value="">Select Route</option>
                                        {% for route in routes %}
                                            <option value="{{ route.id }}">
                                                {{ route.origin }} â†’ {{ route.destination }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Status and Insurance -->
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="status">Status *</label>
                                    <select class="form-control" id="status" name="status" required>
                                        <option value="active">Active</option>
                                        <option value="inactive">Inactive</option>
                                        <option value="maintenance">Maintenance</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="insurance_expiry">Insurance Expiry Date</label>
                                    <input type="date" class="form-control" id="insurance_expiry" 
                                           name="insurance_expiry">
                                </div>
                            </div>
                        </div>

                        <!-- Driver Information -->
                        <div class="form-group">
                            <label for="driver_id">Assign Driver (Optional)</label>
                            <select class="form-control" id="driver_id" name="driver_id">
                                <option value="">Select Driver</option>
                                {% for driver in drivers %}
                                    <option value="{{ driver.id }}">
                                        {{ driver.name }} - {{ driver.license_number }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- Additional Information -->
                        <div class="form-group">
                            <label for="features">Special Features</label>
                            <textarea class="form-control" id="features" name="features" 
                                      rows="2" placeholder="e.g., WiFi, USB Charging, Air Conditioning"></textarea>
                        </div>

                        <!-- Submit Button -->
                        <div class="form-group">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-plus fa-fw mr-1"></i> Add Matatu
                            </button>
                            <a href="{% url 'manage_matatus' %}" class="btn btn-secondary">Cancel</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Sidebar Help -->
        <div class="col-lg-4">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-info-circle fa-fw mr-1"></i>Guidelines
                    </h6>
                </div>
                <div class="card-body">
                    <h6 class="font-weight-bold text-primary">Registration Number</h6>
                    <p class="small">Use the official vehicle registration format (e.g., KAA 123A)</p>
                    
                    <h6 class="font-weight-bold text-primary mt-3">Capacity</h6>
                    <p class="small">Standard matatus: 14-33 seats<br>Large buses: 34-52 seats</p>
                    
                    <h6 class="font-weight-bold text-primary mt-3">Status</h6>
                    <ul class="small pl-3">
                        <li><strong>Active:</strong> Currently operational</li>
                        <li><strong>Inactive:</strong> Not in service</li>
                        <li><strong>Maintenance:</strong> Undergoing repairs</li>
                    </ul>
                    
                    <div class="alert alert-info small mt-3">
                        <i class="fas fa-lightbulb fa-fw mr-1"></i>
                        <strong>Tip:</strong> Assign a route and driver now or update them later.
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}